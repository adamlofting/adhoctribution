<!DOCTYPE html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Ad hoc Contribution Logger</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <style>
            body {
                padding-top: 70px;
                padding-bottom: 20px;
            }
        </style>
        <link rel="stylesheet" href="css/bootstrap-theme.min.css">
        <link rel="stylesheet" href="css/main.css">

    </head>
    <body id="top">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <span class="navbar-brand">Ad hoc Contribution Logger</span>
        </div>
      </div>
    </div>

    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="container">
      <div class="row">
        <div class="col-sm-10">
          {{{body}}}
        </div>
        <div class="col-sm-2">
          {{#if authorized}}
            <p class="small text-right">{{{username}}}</p>
            <button id="logout" class="btn btn-xs btn-warning pull-right">Sign out</button><br /><br />
            <button id="help" class="btn btn-xs btn-info pull-right" data-toggle="modal" data-target="#myModal">Help!</button>
          {{else}}
            {{#unless currentUser}}
            <br />
            <a id="login" class="btn btn-primary btn-lg pull-right" role="button">Sign in &raquo;</a>
            {{/unless}}
          {{/if}}
        </div>
      </div>
    </div>

    <!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">...is at hand.</h4>
      </div>
      <div class="modal-body">
        <h4>What should I record here?</h4>
        <p>Contribution activity that doesn't exist in another database. For example, don't log code contribution here if it's already in Gitbhub. But, this would be a good place to note people who presented on a community call.</p>
        <hr />
        <h4>What counts as contribtuion?</h4>
        <p>In the end, that's your call, but <a href="https://wiki.mozilla.org/Foundation/Metrics/Contributor_Dashboard#Sniff_test" target="_blank">see the Sniff Test</a> for guidance.</p>
        <hr />
        <h4>It broke! And I wish it would...</h4>
        <ul>
          <li><a href="https://github.com/adamlofting/adhoctribution/issues" target="_blank">File a bug or request (github issues)</a></li>
          <li><a href="https://github.com/adamlofting/adhoctribution/" target="_blank">Contribute code.</a></li>
        </ul>
        <hr />
        <h4>How long?</h4>
        <p>The dashboard will be udpated with recent contribution activity within an hour. Backdated activity is updated every few hours.</p>
        <hr />
        <h4>Still not sure about something?</h4>
        <p>Ping Adam Lofting.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/js/vendor/jquery-1.11.0.min.js"><\/script>')</script>
    <script src="/bower/jquery.validation/dist/jquery.validate.min.js"></script>

    <script src="/js/vendor/bootstrap.min.js"></script>
		<script src="https://login.persona.org/include.js"></script>
		<script type="text/javascript">
    var login = document.querySelector("#login");
		if (login) {
      login.addEventListener("click", function() {
  		  navigator.id.request();
  		}, false);
    }

    var logout = document.querySelector("#logout");
    if (logout) {
      logout.addEventListener("click", function() {
        navigator.id.logout();
      }, false);
    }

    var currentUser = null;
    {{#if currentUser}}
    var currentUser = "{{{currentUser}}}";
    {{/if}}

		navigator.id.watch({
      loggedInUser: currentUser,
		  onlogin: function(assertion) {
		    // var xhr = new XMLHttpRequest();
		    // xhr.open("POST", "/persona/verify", true);
		    // xhr.setRequestHeader("Content-Type", "application/json");
		    // xhr.addEventListener("loadend", function(e) {
		    //   var data = JSON.parse(this.responseText);
		    //   if (data && data.status === "okay") {
		    //     console.log("You have been logged in as: " + data.email);
		    //   }
		    // }, false);

		    // xhr.send(JSON.stringify({
		    //   assertion: assertion
		    // }));

        $.ajax({ /* <-- This example uses jQuery, but you can use whatever you'd like */
          type: 'POST',
          url: '/persona/verify',
          data: { assertion: assertion },
          success: function(res, status, xhr) {
            window.location.reload();
          },
          error: function(xhr, status, err) {
            navigator.id.logout();
            alert("Login failure: " + err);
          }
        });
		  },
		  onlogout: function() {
		    // var xhr = new XMLHttpRequest();
		    // xhr.open("POST", "/persona/logout", true);
		    // xhr.addEventListener("loadend", function(e) {
		    //   console.log("You have been logged out");
		    // });
		    // xhr.send();

        $.ajax({
          type: 'POST',
          url: '/persona/logout',
          success: function(res, status, xhr) { window.location.reload(); },
          error: function(xhr, status, err) { alert("Logout failure: " + err); }
        });
		  }
		});</script>
        <script src="js/main.js"></script>
    </body>
</html>
